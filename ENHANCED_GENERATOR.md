# 增强型电路图生成器

## 概述

增强型电路图生成器是对原始Verilog编译器的扩展，它能够为Verilog电路中的每个基本单元（逻辑门、多路选择器等）生成标准化的图形表示。主要功能包括：

1. 为每个电路单元应用统一的标准化样式
2. 使用统一的符号编号($nn)格式标记所有单元
3. 清晰区分输入端口、输出端口和内部连线
4. 支持各种类型的逻辑门和操作符的专门样式

## 设计原理

增强型电路图生成器基于以下几个关键设计原则：

1. **单元级标准化** - 每个电路单元（逻辑门、操作等）都有标准化的图形表示
2. **完整电路结构** - 保留整体电路结构，同时优化各单元的表示方式
3. **符号编号系统** - 所有组件都使用统一的符号编号格式($nn)
4. **端口连接可视化** - 清晰显示信号如何在各单元间流动

## 使用方法

### 基本使用

默认情况下，Verilog编译器现在会使用增强型电路图生成器：

```bash
python src/main.py examples/test_circuit.v
```

这将显示完整的电路结构，并为每个基本单元应用标准化样式。

### 选项和参数

可以使用以下命令行选项：

- `--classic` 或 `-c` - 使用传统的电路图样式（原始生成器）
- `--optimize` 或 `-o` - 启用共享子表达式优化
- `--internal` 或 `-i` - 显示更详细的内部连接细节

组合使用示例：

```bash
python src/main.py examples/test_circuit.v --optimize
```

## 电路单元表示方式

### 1. 基本逻辑门

每个逻辑门都以标准化的方式表示，包括：
- 符号编号 ($nn)
- 门类型 (AND, OR, XOR等)
- 输入端口
- 输出端口

示例格式：
```
┌───────────────┐
│ <a> a │ $01   │ <y> y │
│       │ AND   │       │
└───────────────┘
```

### 2. 三元操作符/多路选择器

三元操作符 (condition ? if_true : if_false) 表示为标准的多路选择器 (Spmux)：

- 符号编号 ($nn)
- 类型标识 (Spmux)
- 选择输入 (标记为 S)
- 数据输入 (标记为 A, B)
- 输出端口

### 3. 操作符

各种操作符具有专门的图形表示：
- 加法器 (+): 标记为 ADD
- 减法器 (-): 标记为 SUB
- 位操作 (&, |, ^): 标记为 AND, OR, XOR
- 非操作 (~): 标记为 NOT

### 4. 端口和连线

- **输入端口**: 组合在输入端口组中
- **输出端口**: 组合在输出端口组中
- **内部连线**: 用于连接不同的组件，有唯一标识符

## 定制和扩展

### 添加新的单元样式

要添加新的电路单元样式，可以扩展 `EnhancedDotGenerator` 类中的相关方法：

1. 在 `_get_gate_type_label` 方法中添加新的门类型映射
2. 在 `_get_operation_type_label` 方法中添加新的操作符映射
3. 如需特殊处理，可以创建专门的处理方法

## 图形输出说明

所有生成的文件都保存在 `output` 目录中：

- `.dot` 文件 - 包含图形描述的DOT格式文件
- `.png` 文件 - 渲染后的图像文件

电路图使用左到右 (LR) 的方向绘制，信号流向清晰可见，便于阅读和分析。 